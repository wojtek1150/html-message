{"version":3,"file":"html-message.js","sources":["ng://html-message/lib/components/html-message.component.ts","ng://html-message/lib/components/html-preview-message.component.ts","ng://html-message/lib/html-parser.service.ts","ng://html-message/lib/pipes/html-parser.pipe.ts","ng://html-message/lib/pipes/html-preview.pipe.ts","ng://html-message/lib/pipes/save-html.pipe.ts","ng://html-message/lib/html-message.module.ts"],"sourcesContent":["import { ChangeDetectionStrategy, Component, Input, ViewEncapsulation } from '@angular/core';\n\n@Component({\n  selector: 'lib-html-message',\n  template: `\n    <div class=\"message\" [innerHtml]=\"message | htmlParser | safeHtml\"></div>\n  `,\n  styleUrls: ['./html-message.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class HtmlMessageComponent {\n  @Input() message: string;\n}\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'lib-html-message-preview',\n  template: `\n    <p>{{message | htmlPreview:length}}</p>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class HtmlPreviewMessageComponent {\n  @Input() message: string;\n  @Input() length = 100;\n}\n","// OLD FOR TEXT MAILS TO HMTL MAILS\nconst REG_CID1 = new RegExp('(\\[cid:[^\\s]+])<([^>]+)><([^>]+)>', 'gmi');\nconst REG_CID2 = new RegExp('(\\\\[cid:[^\\\\s]+])\\\\s+<([^>]+)><([^>]+)>', 'gmi');\nconst REG_LINKS = new RegExp('([^\\\\s<]+)<([^>]+)>', 'gmi');\nconst REG_TRIM_START = new RegExp('^(\\\\s)*');\nconst REG_TRIM_END = new RegExp('(\\\\s)*$');\nconst REG_WHITE_SPACE = new RegExp('\\\\n', 'g');\n// END\nexport const REG_IMAGES = new RegExp('(<img.*\">)', 'gmi');\nexport const REG_OUTLOCK = new RegExp('(_{32}.From.*)', 'gmi');\n\n\nexport class HtmlParserService {\n\n  private static removeCid(s: string): string {\n    return s.replace(REG_CID1, '').replace(REG_CID2, '');\n  }\n\n  private static parseLinks(s: string): string {\n    const replacer = (match, text, url) => match ? `<a href=\"${url}\" target=\"_blank\" rel=\"nofollow\">${text}</a>` : '';\n    return s.replace(REG_LINKS, replacer);\n  }\n\n  private static trim(s: string): string {\n    return s.replace(REG_TRIM_START, '').replace(REG_TRIM_END, '');\n  }\n\n  private static parseHtml(s: string): string {\n    return s\n      .replace('<html><body>', '').replace('</body></html>', '') // Replace wrap\n      .replace('style=\\\"text-align:right;\\\"', 'class=\\\"align-right\\\"') // Replace Align Right\n      .replace('style=\\\"text-align:center;\\\"', 'class=\\\"align-center\\\"') // Replace Align Center\n      .replace(REG_IMAGES, '') // Remove IMGS\n      .replace(REG_OUTLOCK, ''); // Remove Outlock Footer\n  }\n\n  static parse(s: string): string {\n    if (!s) { return ''; }\n    if (s.includes('[cid:')) { // FALLBACK FOR TEXT ONLY MESSAGES\n      return this.trim(this.parseLinks(this.removeCid(s))).replace(REG_WHITE_SPACE, '<br/>');\n    }\n    return this.parseHtml(s);\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { HtmlParserService } from '../html-parser.service';\n\n@Pipe({\n  name: 'htmlParser'\n})\nexport class HtmlParserPipe implements PipeTransform {\n\n  transform(value: string): string {\n    return HtmlParserService.parse(value);\n  }\n\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { REG_OUTLOCK } from '../html-parser.service';\n\n@Pipe({\n  name: 'htmlPreview'\n})\nexport class HtmlPreviewPipe implements PipeTransform {\n\n  transform(value: string, length: number): string {\n    return value\n      .replace(REG_OUTLOCK, '')\n      .replace(/<[^>]*>?/gm, '')\n      .replace('&nbsp;', ' ')\n      .substr(0, length === -1 ? Infinity : length);\n  }\n\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer } from '@angular/platform-browser';\n\n@Pipe({ name: 'safeHtml' })\nexport class SafeHtmlPipe implements PipeTransform {\n  constructor(private sanitized: DomSanitizer) {}\n\n  transform(value) {\n    return this.sanitized.bypassSecurityTrustHtml(value);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { HtmlMessageComponent } from './components/html-message.component';\nimport { HtmlPreviewMessageComponent } from './components/html-preview-message.component';\n\nimport { HtmlParserPipe } from './pipes/html-parser.pipe';\nimport { HtmlPreviewPipe } from './pipes/html-preview.pipe';\nimport { SafeHtmlPipe } from './pipes/save-html.pipe';\n\n@NgModule({\n  declarations: [\n    HtmlMessageComponent,\n    HtmlPreviewMessageComponent,\n    HtmlParserPipe,\n    HtmlPreviewPipe,\n    SafeHtmlPipe\n  ],\n  imports: [\n    CommonModule\n  ],\n  exports: [HtmlMessageComponent, HtmlPreviewMessageComponent]\n})\nexport class HtmlMessageModule {}\n"],"names":[],"mappings":"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"}